{% extends "includes/base/base.html" %}

{% macro svg_img(file_name, alt_text='', class_name='') %}
  <img src="{{ static('svg/{file_name}.svg'.format(file_name=file_name)) }}" alt="{{ alt_text }}" class="{{ class_name }}"/>
{% endmacro %}

{% block js %}
  <script>
    const hamburgerBtn = document.querySelector('#mobile-hamburger-button');
    hamburgerBtn.addEventListener('click', () => {
        const isExpanded = hamburgerBtn.getAttribute('aria-expanded') === 'true';
        hamburgerBtn.setAttribute('aria-expanded', !isExpanded);
    });

    // Adjust sign-in URL based on:
    // - whether we're on prod vs stage
    // - if we're on the appointment marketing page.
    const signinBtn = document.getElementById('signin-button');

    if (signinBtn) {
      const hostname = window.location.hostname;
      const isStage = hostname === 'stage.tb.pro' || hostname === 'localhost';
      const pathname = window.location.pathname;
      let loginUrl;

      // Check if we're on the Appointment marketing page (with or without locale)
      // Matches: /appointment, /en-US/appointment, /fr-FR/appointment, etc.
      const isAppointmentPage = pathname === '/appointment' || pathname.includes('/appointment');

      if (isAppointmentPage) {
        // Appointment-specific login URLs
        if (isStage) {
          loginUrl = 'https://appointment-stage.tb.pro/login';
        } else if (hostname === 'tb.pro') {
          loginUrl = 'https://appointment.tb.pro/login';
        }
      } else {
        // All other pages - regular accounts login
        if (isStage) {
          loginUrl = 'https://accounts-stage.tb.pro/login/';
        } else {
          loginUrl = 'https://accounts.tb.pro/login/';
        }
      }

      if (loginUrl) {
        signinBtn.action = loginUrl;
      }
    }


  </script>
{% endblock %}

{% block content %}
  <div class="top-gradient top-level">
    <header id="site-header" class="primary-block">
      <div id="site-header-nav">
        <a id="nav-link-home" href="{{ url('tbpro.home') }}">
          {{ svg('tbpro/logo-tbpro') }}
        </a>
        <button
          id="mobile-hamburger-button"
          class="hamburger-btn"
          aria-expanded="false"
          aria-controls="nav-menu"

          data-expanded="false"
          type="button"
          >
          <span class="hamburger-icon" aria-hidden="true">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
        <div id="nav-menu">
          <ul>
            <li></li>
            <li>
              <a id="nav-link-thundermail" href="{{ url('tbpro.thundermail') }}">Thundermail</a>
            </li>
            <li>
              <a id="nav-link-appointment" href="{{ url('tbpro.appointment') }}">Appointment</a>
            </li>
            <li>
              <a id="nav-link-send" href="{{ url('tbpro.send') }}">Send</a>
            </li>
            <li class="nav-item-cta-button">
              <form class="bolt-button-wrapper" action="https://accounts-stage.tb.pro/login/" id="signin-button">
                <button class="button-brand-small-outline-label">Sign in</button>
              </form>
            </li>
          </ul>
        </div>
      </div>
    </header>
    <header id="masthead" class="primary-block">
      {% block masthead %} {% endblock %}
    </header>

    {% block features %}{% endblock %}
  </div>

  {% block overview %}
    {# Individual product overviews. #}
  {% endblock %}

  {% block reasons %}
  {% endblock %}

  {% block testimonials %}
  {% endblock %}

  <div class="lower-gradient top-level">
    <section id="details" class="primary-block">
      {% block details %}{% endblock %}
    </section>

    {% block faq %}{% endblock %}
  </div>
{% endblock %}
